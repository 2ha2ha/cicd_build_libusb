name: Auto Commit Demo

on:
  workflow_dispatch:
  
jobs:
  auto-commit:
    runs-on: windows-latest

    permissions:
      contents: write  # 必须开启写权限

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # 获取完整提交历史

    - name: Setup Git config
      run: |
        git config --global user.name "${{ github.actor }}"
        git config --global user.email "${{ github.actor }}@users.noreply.github.com"

    - name: Generate demo file
      run: |
        $date = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        $content = "Auto-generated content at $date"
        Set-Content -Path .\readme.txt -Value $content

    - name: Commit changes
      id: commit
      run: |
        git add .
        $commitMessage = "Auto commit [skip ci]"
        git commit -m "$commitMessage"
      continue-on-error: true  # 允许无修改时失败

    - name: Push changes
      if: steps.commit.outcome == 'success'
      run: |
        git push https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git HEAD:main